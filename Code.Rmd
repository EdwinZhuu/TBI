---
title: "TBI"
author: "Edwin Zhu"
date: "May 12, 2020"
output: html_document
---

```{r, echo=FALSE}
# Setting up appropriate tables

library(readxl)
library(ggpubr)
setwd("C:/Users/edwin/Desktop/Volunteer")
data_path = "C:/Users/edwin/Desktop/Volunteer/CANTBI DTI JHU stats.xlsx"
data_path_labels = "C:/Users/edwin/Desktop/Volunteer/CANTBIANationalBioba_DATA_LABELS_2020-01-13_0952.xlsx"
labels = read_excel(path=data_path_labels)
WMF = read_excel(path=data_path, sheet="WMF")
names(WMF) = as.matrix(WMF[1,])
WMF = WMF[-1,]
WMF[] = lapply(WMF, function(x) as.character(x))
WMF = as.data.frame(WMF)

WMF_skeleton = WMF[1:148,]
WMF_skeleton$type = ifelse(grepl("A$", WMF_skeleton$subject), "baseline", "6_week")
WMF_brain = WMF[152:299,]
WMF_brain$type = ifelse(grepl("A$", WMF_brain$subject), "baseline", "6_week")
WMF_skeleton_ROI = WMF_skeleton[,c(1:50,73)]
WMF_skeleton_Tract = WMF_skeleton[,c(1,52:73)]
WMF_brain_ROI = WMF_skeleton[,c(1:50,73)]
WMF_brain_Tract = WMF_skeleton[,c(1,52:73)]
# Split the dataset into 4 separate datasets
# Skeleton tract and ROI and brain ROI and tract
# Create new column that categorizes each row as either baseline or a 6 week patient

WMF_skeleton_ROIbaseline = WMF_skeleton_ROI[grep("A$", WMF_skeleton_ROI$subject),]
WMF_skeleton_ROI6week = WMF_skeleton_ROI[grep("B$", WMF_skeleton_ROI$subject),]
# Split skeleton ROI table into two tables based on baseline or 6 week

# WMF_skeleton
# WMF_skeleton_baseline[]
# WMF_skeleton_6week[]
```

```{r, echo=FALSE}
# basic use of shapiro test and plotting
# Does not include sex and age
# Does not separate test and base cases

ggplot (WMF_skeleton_ROIbaseline, aes(x=as.numeric(`All ROIs`))) + geom_histogram(color="black", fill="white")
# ggdensity(as.numeric(WMF_skeleton_ROIbaseline$`All ROIs`), main = "test")
shapiro.test(as.numeric(WMF_skeleton_ROIbaseline$`All ROIs`))
# P-value > 0.05 assume normality

ggplot (WMF_skeleton_ROI6week, aes(x=as.numeric(`All ROIs`))) + geom_histogram(color="black", fill="white")
shapiro.test(as.numeric(WMF_skeleton_ROI6week$`All ROIs`))
# Assume normality

t.test((as.numeric(WMF_skeleton_ROIbaseline[,2])), (as.numeric(WMF_skeleton_ROI6week[,2])))

ggplot(WMF_skeleton_ROI, aes(x=as.numeric(`All ROIs`), fill=type, color=type)) +
  geom_histogram(position="identity", alpha=0.5)

ggplot(WMF_skeleton, aes(type, as.numeric(`All ROIs`))) +
  stat_boxplot(geom = "errorbar") + 
  geom_boxplot( aes(type, as.numeric(`All ROIs`))) +    
  xlab("Type") + 
  ylab("All ROIs")

# wilcox.test((as.numeric(WMF_skeleton_baseline[,2])), (as.numeric(WMF_skeleton_6week[,2])))

# histograms run for both baseline and 6 week for the skeleton based on all ROIs
# Both follwed a normal distribution based on the shapiro test
# t.test shows that there is a difference between means 
```

```{r, echo=FALSE}
WMF_skeleton_ROI
labels = na.omit(labels)
colnames(labels)[1] = "subject"
test = stringdist_inner_join(WMF_skeleton_ROI, labels, by = "subject", max_dist = 1)
test
# WMF_labels = merge(WMF_skeleton_ROI, labels, by="subject")
# WMF_labels
# agrep(WMF_brain_ROI[1,1], labels$subject, max.distance = 1)
# labels$subject

```


```{r, echo=FALSE}
FA = read_excel(path=data_path, sheet="FA")
names(FA) = as.matrix(FA[1,])
FA = FA[-1,]
FA[] = lapply(FA, function(x) type.convert(as.character(x)))
FA

MD = read_excel(path=data_path, sheet="MD")
names(MD) = as.matrix(MD[1,])
MD = MD[-1,]
MD[] = lapply(MD, function(x) type.convert(as.character(x)))
MD

AD = read_excel(path=data_path, sheet="AD")
names(AD) = as.matrix(AD[1,])
AD = AD[-1,]
AD[] = lapply(AD, function(x) type.convert(as.character(x)))
AD

RD = read_excel(path=data_path, sheet="RD")
names(RD) = as.matrix(RD[1,])
RD = RD[-1,]
RD[] = lapply(RD, function(x) type.convert(as.character(x)))
RD
```